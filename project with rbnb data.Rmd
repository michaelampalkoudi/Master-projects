---
title: "Εργασία EMOS Official Statistics and Data Analytics"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

Παρακάτω φαίνονται οι βιβλιοθήκες που χρησιμοποίησα και οι εντολές για τη φόρτωση των δεδομένων
```{r}
options(warn=-1)
library(tibble)
library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
library(readr)
reviews_detailed <- read_csv("reviews_detailed.csv")
reviews <- read_csv("reviews.csv")
listings_detailed <- read_csv("listings_detailed.csv")
listings <- read_csv("listings.csv")
calendar <- read_csv("calendar.csv")

```

 
Ερώτηση 1:Να βρεθεί ο host_name με τα περισσότερα listings (σε απόλυτο αριθμό)(Μονάδες 10)

Μεθοδολογία:Βρίσκω αρχικά το πλήθος των διαφορετικών hosts. Έπειτα, βρίσκω το πίνακα συχνοτήτων εμφάνισης κάθε host id στο dataset:listings. Μετά βάζω τον πίνακα συχνοτήτων σε φθίνουσα σειρά, παίρνω τα 2 πρώτα στοιχεία του πίνακα και βλέπω, ότι υπάρχει ένας μόνο host με το περισσότερο πλήθος εμφανίσεων  με id=102947901. Μετά κρατάω από to dataset μόνο όσους έχουν το παραπάνω id και τέλος επιλέγω το όνομα του host
```{r}
#dim(listings%>%distinct(host_id))
#άρα 11969 είναι οι hosts συνολικά
a1<-table(listings$host_id)#βρισκω τις συχνότητες εμφάνισης κάθε host id
a2<-a1[order(a1,decreasing=TRUE)]#βάζω σε φθίνουσα σειρά τις παραπάν συχνότητες
#a3[1]
#a3[2]#για να σιγουρευτω οτι δεν υπαρχει κι αλλος με τα περισσοτερα listings
#ara o host me ta perissotera listings einai autos me id 102947901
a3<-unique(filter(listings,host_id==102947901)%>%select(host_name))
#αρα ο host name με τα περισσότερα listings είναι η Claudia με host_id 102947901
sprintf('O host με τα περισσότερα listings είναι η %s.', a3)


```

Ερώτηση 2:Τι ποσοστό των host είναι superhost;(Μονάδες 10)

Μεθοδολογία: Βρίσκω αρχικά το πλήθος των hosts που είναι superhost, το ίδιο και αυτών που δεν είναι. Παρατηρώ οτι η μεταβλητή host_is_superhost έχει NA, γι αυτό υπολογίζω το ποσοστό παίρνοντας ως παρανομαστή το αθροισμα του πλήθους των superhost και των no-superhost γιατί παρατήρησα πως υπάρχουν missingvalues γιa τη μεταβλητή  host_is_superhost, που σημαίνει ότι για κάποιους host δεν έχουμε πληροφορές για το αν ήταν superhost ή όχι, οπότε αποφάσισα να υπολογίσω το ποσοστό με βάση τα στοιχεία που υπήρχαν.Δηλαδή στο ποσοστό δεν επέλεξα να το υπολογίσω με παρανομαστή το πλήθος των διαφορετικών host_id, αλλά ως παρανομαστή πήρα το άθροισμα των διαφορετικών host id που είχα πληροφορές για το αν ήταν superhost ή όχι και στον αριθμητή έβαλα το πλήθος των superhost.
```{r}
a4<-filter(listings_detailed,host_is_superhost==TRUE)
a5<-a4%>%distinct(host_id)
#dim(a5)#πλήθος των superhost 
a6<-filter(listings_detailed,host_is_superhost==FALSE)
a7<-a6%>%distinct(host_id)
#dim(a7)#πλήθος αυτών που δεν είναι superhost
par<-dim(a7)[1]+dim(a5)[1]
x<-sum(is.na(listings_detailed$host_is_superhost))#βλεπω ότι υπάρχουν missing values για την μεταβλητή
#host_is_superhost, για αυτό στον παρανομαστή δε θα βάλω όλους τουσ διαφορετικούς
#hosts αλλά το άθροισμα των superhost με τους non superhost

pososto<-dim(a5)[1]/par
pososto<-pososto*100
sprintf('Το ποσοστό των host που είναι superhost είναι %.2f%%',pososto )
```



Ερώτηση 3:Nα βρείτε τα ονόματα των καταλυμάτων τα οποία επισκέφτηκε ο χρήστης με τα περισσότερα reviews(Μονάδες 10)

Μεθοδολογία:Βρίσκω αρχικά πόσους reviewers έχουμε, έπειτα κάνω ένα πίνακα συχνοτήτων εμφάνισης για κάθε reviewer, βλέπω το id του reviewer με τις περισσότερες συχνότητες εμφάνισης. Μετά, επιλέγω μόνο τις καταχωρήσεις με reviewer id=18544876 από το dataset reviews_detailed και αυτό το κάνω inner join με το πίνακα listings προκειμένου να βρω τα ονόματα καταλυμμάτων για αυτόν τον reviewer.
```{r}
a<-table(reviews_detailed$reviewer_id)

#str(reviews_detailed%>%distinct(reviewer_id))#deixnei posous reviewers exoume
b<-a[order(a,decreasing=TRUE)]#βάζω σε θθίνουσα σειρά τις παραπάνω συχνότητες
#b
#blepw oti o xrhsths me ta perissotera reviews (66) einai autos me id 18544876 και όνομα Israel
c<-filter(reviews_detailed,reviews_detailed$reviewer_id==18544876)#κρατάω μόνο το reviewer id με τις περισοότερες κριτικές
listings$listing_id<-listings$id##το κάνω για να κάνω Inner join ως προς listing_id
b<-select(listings,name,listing_id)
#b
a<-inner_join(b,c,by="listing_id")%>%distinct(listing_id,name)
#a
print(as.matrix(a), quote = FALSE)


```

Ερώτηση 4:Με βάση τα στοιχεία του πίνακα reviews_detailed να βρείτε το πιο δημοφιλές κατάλυμα(συνολικός αριθμός reviews) και το όνομα του ατόμου που το οποίο πραγματοποίησε τις περισσότερες κριτικές για αυτό. (Μονάδες 10)

Μεθοδολογία: Βρίσκω πρώτα το πίνακα συχνοτήτων εμφάνισης του κάθε listing id στο dataset reviews_detailed, βλέπω ποιό κατάλυμα είχε τις περισσότερες κριτικές, βρίσκω το id του, μετά κρατάω μόνο τις τιμές του πίνακα reviews_detailed που έχουν το συγκεκριμένο id, κι σε αυτό το υποσύνολο που έχει προκύψει βρiσκω ένα πίνακα συχνοτήτων με βάση το reviewer id, μετά το βάζω σε φθίνουσα σειρά, έτσι βρίσκω το id  του reviewer με τις περισσότερες κριτικές. Τέλος εφόσον έχω κρατήσει μόνο τις παρατηρήσεις με το παραπάνω id, επιλέγω το όνομα του reviewer.
```{r}
a9<-table(reviews_detailed$listing_id)#για κάθε listing id που έγινε κριτική βρίσκω πόσες κριτικές έγιναν συνολικά
a10<-a9[order(a9,decreasing=TRUE)]#βάζω τον παραπάνω πινακα συχνοτήτων σε φθίνουσα σειρά
#a10
#a10[1]
#a10[2]
#άρα το κατάλυμα με τα περισσότερα reviews είναι αυτό me listing id 93100
a11<-filter(reviews_detailed,listing_id==93100)%>%
  select(listing_id,reviewer_id,reviewer_name)#κρατάω από το reviews detailed μόνο
#όσα έχουν listing=id 93100,κι μόνο τις στήλες που δινουν τα listing_id,reviewer_id,reviewer_name
onoma1<-subset(listings_detailed,id==93100)$name# το όνομα καταλύματος με περισσότερες κριτικές
sprintf( 'Το κατάλυμα με τις περισσότερες κριτικές είναι το: %s', onoma1)
a12<-table(a11$reviewer_id)#βρίσκω για κάθε reviewer_id που έκανε κριτική
#για το listing id=93100, πόσες φορές το έκανε αυτό
a13<-a12[order(a12,decreasing=TRUE)]#βάζω σε φθίνουσα σειρά τον παραπάνω πίνακα
#a13[1]
#άρα το reviewer_id με τις περισσότερες κριτικές για το πιο δημοφιλές κατάλυμα είναι 2801872
onomaofreviewer<-unique(filter(a11,reviewer_id==2801872))$reviewer_name#βλέπω το όνομα του reviewer με id=2801872
sprintf('Ο χρήστης έκανε τις περισσότερες κριτικές για αυτό ήταν ο/η: %s',onomaofreviewer)
#Άρα, η Mary με reviewer_id=2801872 είναι αυτή που πραγματοποίησε τις περισσότερες κριτικές για το δημοφιλέστερο κατάλυμα που είναι το MALASANA B&B
```


Ερώτηση 5:Ποιος μήνας από τους καταγραφόμενους(βλέπετε πίνακας calendar) είχε τα περισσότερα διαθέσιμα δωμάτια; (Μονάδες 10)

Μεθοδολογία: Kρατάω αρχικά μονο τα διαθέσιμα δωμάτια, μετά τα ομαδοποιώ με βάση το μήνα. Βρίσκω τις συχνότητες για κάθε μήνα και τις βάζω σε φθίνουσα σειρά. Βλέπω ότι ο Δεκέμβριος του 2019 είχε τα περισσότερα διαθέσιμα δωμάτια
```{r}
a14<-filter(calendar,available==TRUE)%>%
  group_by(month(date),year(date))
a15<-a14%>%tally%>%arrange(desc(n))
mhnas<-a15[1,]$ `month(date)`
xronia<-a15[1,]$`year(date)`
sprintf('Ο μήνας με τα περισσότερα διαθέσιμα δωμάτια είναι ο  %s', mhnas)
sprintf('δηλαδή ο Δεκέμβριος της  χρονιάς %s',xronia)

```

Ερώτηση 6:Βάση του πίνακα calendar και του reviews_detailed να βρείτε τα μέσα κέρδη(συνολικά έσοδα/πλήθος κατηγορίας) των καταλυμάτων ως προς τις κατηγορίες της στήλης host_response_time (Μονάδες 10)

Μεθοδολογία:Όπως και στο 10 ερώτημα: Τα δεδομένα αφορούν 2 χρονικές περιόδους, η πρώτη αναφέρεται σε παρελθοντικά κέρδη για κάθε κατάλυμα και η άλλη σε μελλοντικά κέρδη, εφόσον υπάρχουν ημερομηνίες που δεν έχουν περάσει ακόμη. Έτσι, όπως ορίσθηκαν τα κέρδη για το παρελθόν(δουλέυω με πίνακα reviews detailed και listings detailed) για κάθε κατάλυμα, τα βρίσκω υπολογίζοντας  το γινόμενο τιμής καταλύματος( αφου βέβαια το μετατρέψω σε κατάλληλη μορφή αφαιρώντας το σύμβολο του δολλαρίου) επί το πλήθος των reviews πού έγιναν γι αυτό το κατάλυμα. Για να υπολογίσω τα μελλοντικά κέρδη απο το 2019 και μετά(δουλεύω με τον πίνακα calendar) βλέπω ποια καταλύματα θα είναι διαθέσιμα για ενοικίαση , δηλαδή available==TRUE, προκειμένου να υπολογίσω τα μέγιστα  δυνατά κέρδη για τo κάθε κατάλυμα στο μέλλον, αθροίζοντας για το καθένα την τιμή του για κάθε ημερομηνία που φαίνεται να είναι διαθέσιμο για ενοικίαση, η οποία διαφοροποιείται,δηλαδή δεν είναι σταθερή όπως στο πίνακα reviews_detailed. Προκειμένου να υπολογίσω το τελικό κέρδος για κάθε κατάλυμα πρεπει να ενώσω τους πίνακες που περιέχουν τα 2 είδη κερδών που είχα για τις 2 χρονικές περιόδους, ώστε να αθροίσω τα 2 είδη κερδών για κάθε κατάλυμα. Όταν για κάποιο κατάλυμα δεν υπάρξει ένα από τα 2 είδη κερδών(είτε γιατί γι αυτό δεν είχα κάποιο review είτε γιατί δεν θα είναι διαθέσιμο για καμία μέρα από το Σεπτέμβριο του 2019 κι μετά) τότε έχω ΝΑ στη μεταβλητή του αντίστοιχου κέρδους, γι αυτό βάζω την τιμή 0  στο κέρδος αυτό, αφου δεν έχει συνεισφορά. Μετά στο τελικό πίνακα , κάνω μια νέα στήλη που περιέχει το άθροισμα των στηλών των 2 ειδών κερδών. Έτσι, για κάθε κατάλυμα έχω το ολικό κέρδος του για όλη τη δεκαετία. Τώρα, ξεκινάει η διαφοροιποίηση σε σχέση με το 10 ερώτημα, διότι ομαδοποιώ τον τελικό πίνακα με βάση τη host response time που έχει 6 κατηγορίες. Μάλιστα παρατηρώ ότι  δεν υπάρχει το όνομα της έκτης κατηγορίας. Τέλος, βρίσκω τις συχνότητες κάθε κατηγορίας και υπολογίζω το άθροισμα των τελικών κερδών ανά κατηγορία. 'Ετσι, υπολογίζω τις ζητούμενες μέσες τιμές για κάθε κατηγορία, διαρώντας το άθροισμα των ολικών κερδών των καταλυμάτων που ανήκουν στην αντίστοιχη κατηγορία δια το πλήθος της.

```{r}
a16<-filter(calendar,available==TRUE)
pr<-str_replace_all(a16$price, "[^[:alnum:]]", " ")#εντολή για να αφαιρέσω το δολλαριο
#pr

pr1<-str_replace_all(pr," ","")#εντολη για να αφαιρέσω τα κενά της Price
pr2<-as.numeric(pr1)
a16$timi<-pr2
a17<-group_by(a16,listing_id)%>%summarise(s=sum(timi,na.rm=TRUE))#για κάθε listing id βρίσκω τα μελλοντικά κέρδη του από το Σεπτέμβριο του 2019 και μετά, αθροίζοντας τα κέρδη του για όλες τις ημερομηνές που φαίνεται να είναι διαθέσιμο

#στο α17 βρίσκονται τα κέρδη για κάθε κατάλυμμα από το 2019 και μετά για το οποίο θα υπάρχει μια τουλαχιστον μέρα διαθεσιμότητας
a18<-group_by(reviews_detailed,listing_id)%>%tally#βρίσκv πόσα review για κάθε κατάλυμα που έγινε τουλάχιστον μία κριτική
#a18$n
a19<-select(listings_detailed,id,price)#το χρησιμοποίω για να βρώ τα ονόματα των καταλυμάτων
a19$listing_id<-a19$id
a20<-inner_join(a18,a19,by="listing_id")#το κάνω για να βρω τα ονόματα καταλυμάτων στα οπόια έγιναν κριτικές
#προκειμένου να έχω πληροφορίες σε ένα πίνακα σχετικά με το όνομα του καταλύματος και πόσα review έγιναν γι αυτο
#a20
price1<-str_replace_all(a20$price, "[^[:alnum:]]", " ")
#price1

price2<-str_replace_all(price1," ","")
price2<-as.numeric(price2)
a20<-cbind(a20,price2)
a20$kerdos2<-0
a20$kerdos2<-a20$n*a20$price2#παρελθοντικό κέρδος τιμή * πλήθος των reviews
a20$id<-a20$listing_id# για να έχω κοινό όνομα στα id, με βάση τα οποία θα κάνω ένωση πινάκων
#str(a20)
a21<-left_join(select(listings_detailed,name,id), a20, by="id")
a17$id<-a17$listing_id
a21<-left_join(a21,a17,by="id")
#str(a21)
a21[is.na(a21)]=0
a21$kerdosol<-(a21$kerdos2+a21$s)/100#διαιρώ με 100, διότι τα κέρδη είναι ουσιστικά πολλαπλασισμένα με 100, λόγω της κατάλληλης αριθμητικής μετατροπής των τιμών ενοικίασης των καταλυμάτων
#str(a21)
a22<-full_join(a21,select(listings_detailed,id,name,host_response_time), by="id")#προκειμένου να εισάγω την μεταβλητή host_response_time με βάση την οποία θα γίνει ομαδοποίηση
a23<-group_by(a22,host_response_time)%>%summarize(plithos=n())#υπολογίζω τις συχνότητες εμφάνισης κάθε κατηγοράς
#str(a23)
a24<-group_by(a22,host_response_time)%>%summarize(ol=sum(kerdosol))
a24$mean<-a24$ol/a23$plithos
#select(a24,host_response_time,mean)
#a25<-length(unique(listings_detailed$host_response_time))
#unique(listings$host_response_time)
mesitimi.kathe.kathgorias<-a24[c("host_response_time","mean")]
print(as.matrix(mesitimi.kathe.kathgorias), quote = FALSE)
```


Ερώτηση 7:Να βρείτε τις μέσες τιμές(κόστος καταλύματος) για καταλύματα τύπου Entire home/apt τα οποία είχαν διαθεσιμότητα λιγότερο από 20 μέρες τον χρόνο (Μονάδες 5)

Μεθοδολογία:Αρχικά με τις πρώτες εντολές αφαιρώ τα δολλάρια και τα εισαγωγικά, έτσι μετατρέπω την price σε αριθμητική μεταβλητή προκειμένου να τη χρησιμοποιήσω για την εύρεση του κόστους. Μετά την κατάλληλη μετατροπή της price από την listings_detailed, δημιουργώ μία νέα μεταβλητή prnum η οποία με τον τρόπο που την υπολόγισα περιέχει την την τιμή κάθε καταλύματος πολλαπλασιασμένη με 100, με βάση την οποία θα βρω την αναμενόμενη μέση τιμή. Από τον πίνακα listings_detailed, κρατάω μόνο καταλύματα τύπου Entire home/apt και με διαθεσιμότητα λιγότερο απο 20 μέρες το χρόνο. Για το τελικό αυτό υποσύνολο βρίσκω τη μέση τιμή για την μεταβλητή prnum, αφαιρώντας πιθανά missing values. Στο τέλος, διαιρώ με 100, διότι κατά την μετατροπή της price στην κατάλληλη μορφή είχα 2 επιπλέον ψηφία στο τέλος που ουσιατικά, είναι 2 δεκαδικά ψηφία, γι αυτό με τη διαίρεση με το 100, παίρνουμε την ζητούμενη μέση τιμη.
```{r}
y<-str_replace_all(listings_detailed$price, "[^[:alnum:]]", " ")
x1<-str_replace_all(y," ","")
x2<-as.numeric(x1)
#sum(is.na(x2))
#class(listings_detailed)
#str(listings_detailed)
listings_detailed$prnum<-x2
#str(listings_detailed)
#class(listings_detailed)
x3<-filter(listings_detailed,room_type=="Entire home/apt")%>%filter(availability_365<20)%>%summarise(me1=mean(prnum,na.rm=TRUE))
x3$me1<-x3$me1/100
meanvalue<-x3$me1
sprintf('Η μέση τιμή(κόστος καταλύματος) για καταλύματα τύπου Entire home/apt τα οποία είχαν διαθεσιμότητα λιγότερο από 20 μέρες τον χρόνο είναι %.3f $',meanvalue)
```

Ερώτηση 8:Να βρείτε την μέση τιμή καταλυμάτων τύπου Entire home/apt στην περιοχή (neighbourhood_group) Arganzuela (Μονάδες 5)

Μεθοδολογία:Επιλέγω μόνο τα καταλύματα τύπoυ Entire home/apt στην περιοχή (neighbourhood_group) Arganzuela και βρίσκω για αυτά τη μέση τιμή της μεταβλητής prnum(τιμή καταλύματος) που έχω υπολογίσει απο στο προηγούμενο ερώτημα και εξαιρώ πιθανά missing values. Διαιρώ με 100, διότι ουσιαστικά η prnum περιέχει την τιμή του καταλύματος *100
```{r}
k1<-filter(listings_detailed,room_type=="Entire home/apt",neighbourhood_group_cleansed=="Arganzuela")%>%
  summarise(me2=mean(prnum,na.rm=TRUE))
mt<-k1/100
sprintf('Μέση τιμή καταλυμάτων τύπου Entire home/apt στην περιοχή (neighbourhood_group) Arganzuela είναι %.3f $',mt)


```
Ερώτηση 9:Να βρείτε τον συνολικό αριθμό reviews ανά έτος.Υπάρχει κάποιου είδους συσχέτιση του αριθμού των reviews με τον χρόνο;Να το δείξτε μέσω κατάλληλου διαγράμματος (Μονάδες 15)

Μεθοδολογία: Χρησιμοποιώ την βιβλιοθηκη lubridate, για να διαχειριστώ τις ημερομηνίες. Οπότε για κάθε χρονιά , βρίσκω το πλήθος των reviews, ομαδοποιώντας τα δεδομένα του reviews με βάση τη χρονία. Το πίνακα συχνοτήτων τον μετατρέπω σε data.frame προκειμένου να δω γραφικά το πλήθος των reviews με το χρόνο, υπολογίζοντας ένα ιστόγραμμα με βάση το πλήθος των reviews ανά χρονιά. Με βάση το ιστόγραμμα που προκύπτει, βλέπω πώς από το 2010 μέχρι το 2018 έχω μία αυξανόμενη τάση του πλήθους των reviews σε σχέση με το πέρασμα τoυ χρόνoυ που μοιάζει να γίνεται με εκθετικό ρυθμό. Όμως, δεν μπορώ να ισχυριστώ ότι υπάρχει εκθετική συσχέτιση ή κάποιου άλλου είδους μονότονης συσχέτισης των reviews με τον χρόνο, διότι κατά το 2019 έχω μείωση του πλήθους των reviews σε σχέση με το 2018. Δηλαδή, δεν μπορώ να πω ότι το πλήθος των reviews αυξάνεται ή  μειώνεται σε σχέση με το χρόνο από το 2010 μέχρι τo 2019, διότι η αυξανόμενη χρονική τάση του πλήθους των reviews συμβαίνει μέχρι το 2018 και έπειτα από το 2018 στο 2019 έχω μείωση του πλήθους των reviews.

```{r}
#θα δω για αρχη πόσα έτη έχω από το 2010 εως 2019

revyear<-reviews%>%group_by(year(date))%>%tally%>%arrange(n)
revyear<-as.data.frame(revyear)
print(as.matrix(revyear),quote = FALSE)
library(ggplot2)
g<-ggplot(revyear,aes(x = revyear[,1], y = revyear[,2]))+geom_col()+scale_x_discrete()+labs(title='Κριτικές ανά χρόνο',caption = waiver(),tag = waiver())+geom_label(aes(label=revyear[,1]))+xlab("xronos")+ylab("number of revivews")
g

```
Ερώτηση 10:Από τα διαθέσιμα στοιχεία που προκύπτουν από τον πίνακα calendar και reviews_detailed να βρεθούν τα 20 πιο επικερδή καταλύματα (Μονάδες 15)

Μεθοδολογία:Δουλέυω αντίστοιχα όπως στο ερώτημα 6, δηλαδή στόχος είναι για κάθε ένα από τα 201837 καταλύματα να βρώ τα συνολικά του κέρδη για όλη τη δεκαετία και δουλεύω ουσιαστικά σε 2 χρονικές μονάδες, μία για το παρελθον και μία για το μέλλον.Για το μέλλον, αξίζει να σημειωθεί ότι εκτιμώ τα μέγιστα δυνατά κέρδη για κάθε κατάλυμα, αφού υπολογίζω τα κέρδη αθροίζοντας τις τιμές ενοικίασης τους για κάθε διαθέσιμη ημέρα ενοικίασης(available==TRUE) που έχει καταγραφεί στο calendar. Αναλυτικά παραθέτω την ίδια μεθοδολογία με το ερώτημα 6 μέχρι το σημείο που έιχε εισαχθεί η μεταβλητή host response time. 

Αναλυτικά:Τα δεδομένα αφορούν 2 χρονικές περιόδους, η πρώτη αναφέρεται σε παρελθοντικά κέρδη για κάθε κατάλυμα και η άλλη σε μελλοντικά κέρδη, εφόσον υπάρχουν ημερομηνίες που δεν έχουν περάσει ακόμη. Έτσι, όπως ορίσθηκαν τα κέρδη για το παρελθόν(δουλέυω με πίνακα reviews detailed και listings detailed) για κάθε κατάλυμα, τα βρίσκω υπολογίζοντας  το γινόμενο τιμής καταλύματος( αφου βέβαια το μετατρέψω σε κατάλληλη μορφή αφαιρώντας το σύμβολο του δολλαρίου) επί το πλήθος των reviews πού έγιναν γι αυτό. Για να υπολογίσω τα μελλοντικά κέρδη απο το 2019 και μετά(δουλεύω με τον πίνακα calendar) βλέπω ποια καταλύματα θα είναι διαθέσιμα για ενοικίαση , δηλαδή available==TRUE, προκειμένου να υπολογίσω τα μέγιστα  δυνατά κέρδη για τo κάθε ένα κατάλυμα στο μέλλον, αθροίζοντας για το καθένα την τιμή του για κάθε ημερομηνία που φαίνεται να είναι διαθέσιμο για ενοικίαση, η οποία διαφοροποιείται,δηλαδή δεν είναι σταθερή όπως στο πίνακα reviews_detailed. Προκειμένου να υπολογίσω το τελικό κέρδος για κάθε κατάλυμα πρεπει να ενώσω τους πίνακες που είχα για τις 2 χρονικές περιόδους και περιέχουν τα 2 είδη κερδών, ώστε να αθροίσω τα 2 είδη κερδών για κάθε κατάλυμα. 'Οταν για κάποιο κατάλυμα δεν υπάρξει ένα από τα 2 είδη κερδών(είτε γι αυτό δεν είχα κάποιο review είτε γιατί δεν θα είναι διαθέσιμο για καμία μέρα από το Σεπτέμβριο του 2019 και μετά) τότε έχω ΝΑ στη μεταβλητή του αντίστοιχου κέρδους, γι αυτό βάζω την τιμή 0  στο κέρδος αυτό, αφου δεν έχει συνεισφορά. Μετά στο τελικό πίνακα , κάνω μια νέα στήλη που περιέχει το άθροισμα των στηλών των 2 ειδών κερδών. Έτσι, για κάθε κατάλυμα έχω το ολικό κέρδος του για όλη τη δεκαετία. Στο τελικό πίνακα που έχει προκύψει κι περιέχει τα συνολικά  κέρδη για κάθε κατάλυμα για όλη τη δεκαετία, κάνω φθίνουσα ταξινομήση ως προς τα ολικά κέρδη και επιλέγω τα 20 πρώτα καταλύματα, που αποτελούν τα 20 πιο επικερδή καταλύματα για όλη τη δεκαετία.
```{r}
a16<-filter(calendar,available==TRUE)
pr<-str_replace_all(a16$price, "[^[:alnum:]]", " ")#εντολή για να αφαιρέσω το δολλαριο
#pr
pr1<-str_replace_all(pr," ","")#εντολη για να αφαιρέσω τα κενά της Price
pr2<-as.numeric(pr1)
a16$timi<-pr2
a17<-group_by(a16,listing_id)%>%summarise(s=sum(timi,na.rm=TRUE))#για κάθε listing id βρίσκω τα μελλοντικά κέρδη του από το 19 και μετά
#str(a17)
#στο α17 βρίσκονται τα κέρδη για κάθε κατάλυμμα από το 2019 και μετά για το οποίο θα υπάρχει μια τουλαχιστον μέρα διαθεσιμότητας
a18<-group_by(reviews_detailed,listing_id)%>%tally#βρίσκς πόσα review για κάθε κατάλυμα που έγινε τουλάχιστον μία κριτική
#a18$n
a19<-select(listings_detailed,id,price)#το χρησιμοποίω για να βρώ τα ονόματα των καταλυμάτων
a19$listing_id<-a19$id
a20<-inner_join(a18,a19,by="listing_id")#το κάνω για να βρω τα ονόματα καταλυμάτων στα οπόια έγιναν κριτικές
#προκειμένου να έχω πληροφορίες σε ένα πίνακα σχετικά με το όνομα του καταλύματος και πόσα review έγιναν γι αυτο
#a20
price1<-str_replace_all(a20$price, "[^[:alnum:]]", " ")#κατάλληλη μετατροπή της price ώστε να είναι αριθμητικήχ χωρίς σύμβολα


price2<-str_replace_all(price1," ","")
price2<-as.numeric(price2)
a20<-cbind(a20,price2)
a20$kerdos2<-0
a20$kerdos2<-a20$n*a20$price2#τιμή * πλήθος reviews
a20$id<-a20$listing_id#το κάνω για να ενώσω τους 2 πίνακες
#str(a20)
a21<-left_join(select(listings_detailed,name,id), a20, by="id")
a17$id<-a17$listing_id
a21<-left_join(a21,a17,by="id")
#str(a21)
a21[is.na(a21)]=0#μηδενική συνεισφορά στο ολικό κέρδος, όταν δεν υπάεχει αυτό το είσος του κέρδους
a21$kerdosol<-(a21$kerdos2+a21$s)/100#διαιρώ με 100, διότι τα κέρδη ήταν πολλαπλασιασμένα με 100

epikerdoi20=head(arrange(a21,desc(kerdosol)),20)%>%select(name)
print(as.matrix(epikerdoi20),quote=FALSE)
```

```{r}

```

